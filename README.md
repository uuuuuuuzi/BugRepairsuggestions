# 漏洞修复建议大全

> 早先一直靠老版本的Word文档苟延残喘，然后公司内网平台有了以后用公司的，怎奈太久没更新了好多不适用，加之人懒，VPN都不想登，便开设此项目。
>
> 该项目持续更新~

## SQL注入

## 弱口令

1、用户登录后需要对初始口令进行修改，防止攻击者利用初始口令进行暴力破解。

2、系统设置强密码策略，建议用户密码采用10位以上数字加大小写字母。

3、对密码暴力猜解行为进行图灵验证，一旦发现用户口令破解行为及时对账户进行限时封停处理。

## 未授权访问

1、对于每个功能的访问，需要明确授予特定角色的访问权限。

2、如果某功能参与了工作流程，检查并确保当前的条件是授权访问此功能的合适状态。

## XSS跨站脚本攻击

建议过滤的关键字为：

[1] ' 单引号

[2] " 双引号

[3] / 斜杠

[4] \ 反斜杠

[5] ) 括号

[6] ; 分号

[7] [ 中括号

[8] < 尖括号

[9] > 尖括号

比如把<编码为<

在cookie中加入httponly属性可以在一定程度上保护用户的cookie，减少出现XSS时损失。

## 目录列表

1、对于apache服务器，在apache配置文件httpd.conf中，从Options中删除Indexes。

2、对于IIS服务器，禁用目录浏览属性。

## CVE-2019-0708远程代码执行

1、及时打对应系统的安全补丁

2、关闭3389端口或添加防火墙安全策略限制对3389端口的访问

3、打不了补丁的可以开启远程桌面（网络级别身份验证(NLA)），可以临时防止漏洞攻击

## Apache Tomcat文件包含(CNVD-2020-10487/CVE-2020-1938)

目前，Apache 官方已发布 9.0.31、8.5.51 及 7.0.100 版本对此漏洞进行修 复，建议用户尽快升级新版本：

https://tomcat.apache.org/download-70.cgi

https://tomcat.apache.org/download-80.cgi

https://tomcat.apache.org/download-90.cgi

如果暂时无法升级最新版本，可采取临时缓解措施：

1、如未使用 Tomcat AJP 协议：

如未使用 Tomcat AJP 协议，可以直接将 Tomcat 升级到 9.0.31、8.5.51 或 7.0.100 版本进行漏洞修复。

如无法立即进行版本更新、或者是更老版本的用户，建议直接关闭 AJPCon nector，或将其监听地址改为仅监听本机 localhost。

具体操作：

（1）编辑 Code: [["", [], []], "<CATALINA_BASE>"]/conf/server.xml，找到如下行（Code: [["", [], []], "<CATALINA_B ASE>"]为 Tomcat 的工作目录）：

<Connector port="8009"protocol="AJP/1.3" redirectPort="8443" /> 

（2）将此行注释掉（也可删掉该行）：

<!--<Connectorport="8009" protocol="AJP/1.3"redirectPort="8443" />--> 

（3）保存后需重新启动，规则方可生效。

2、如果使用了 Tomcat AJP 协议：

建议将 Tomcat 立即升级到 9.0.31、8.5.51 或 7.0.100 版本进行修复，同时 为 AJP Connector 配置 secret 来设置 AJP 协议的认证凭证。例如（注意必须将 Y OUR_TOMCAT_AJP_SECRET 更改为一个安全性高、无法被轻易猜解的值）：

\```

<Connector port="8009"protocol="AJP/1.3" redirectPort="8443"address="YO UR_TOMCAT_IP_ADDRESS" secret="YOUR_TOMCAT_AJP_SECRET"/>

\```

如无法立即进行版本更新、或者是更老版本的用户，建议为 AJPConnector 配置 requiredSecret 来设置 AJP 协议认证凭证。例如（注意必须将 YOUR_TOMC AT_AJP_SECRET 更改为一个安全性高、无法被轻易猜解的值）：

\```<Connector port="8009"protocol="AJP/1.3" redirectPort="8443"address="YO UR_TOMCAT_IP_ADDRESS"requiredSecret="YOUR_TOMCAT_AJP_SECRET" />

\```

## 信息泄露

1、对身份验证时传输的用户名密码等作加密处理，为了防止重放攻击可以在验证时加个随机数，以保证验证单次有效。

2、关闭错误输出，防止调试信息泄露，或者当web应用程序出错时，统一返回一个错误页面或直接跳转至首页

3、合理设置服务器端各种文件的访问权限

4、尽量避免跨域的数据传输，对于同域的数据传输使用xmlhttp的方式作为数据获取的方式，依赖于javascript在浏览器域里的安全性保护数据。如果是跨域的数据传输，必须要对敏感的数据获取做权限认证，例如对referer的来源做限制，加入token等

## 任意文件上传

处理用户上传文件，要做以下检查：

1、 检查上传文件扩展名白名单，不属于白名单内，不允许上传。

2、 上传文件的目录必须是http请求无法直接访问到的。如果需要访问的，必须上传到其他（和web服务器不同的）域名下，并设置该目录为不解析jsp等脚本语言的目录。

3、 上传文件要保存的文件名和目录名由系统根据时间生成，不允许用户自定义。

4、 图片上传，要通过处理（缩略图、水印等），无异常后才能保存到服务器。

## 任意文件下载或读取

1、对相应参数进行过滤，依次过滤“.”、“..”、“/”、“”等字符。

2、或者对于下载文件的目录做好限制，只能下载指定目录下的文件，或者将要下载的资源文件路径存入数据库，附件下载时指定数据库中的id即可，id即对应的资源。

## 命令执行注入

1、尽量避免使用exec、system、passthru、popen、shell_exec、eval、execute、assert等此类执行命令/执行代码相关函数。

2、执行代码/命令的参数，或文件名，不要使用外部获取，禁止和用户输入相关，只能由开发人员定义代码内容，用户只能提交“1、2、3”参数，代表相应代码，防止用户构造。

## 短信炸弹

1、限制每个手机号的每日发送次数，超过次数则拒发送，提示超过当日次数。

2、每个ip限制最大限制次数。超过次数则拒发送，提示超过ip当日发送最大次数。

3、限制每个手机号发送的时间间隔，比如两分钟，没超过2分钟，不允许发送，提示操作频繁。

4、应具有页面图片验证码、IP访问次数限制功能!